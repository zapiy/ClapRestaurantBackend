import{u as _,A as j}from"./use-swrv-1943a49d.js";import{L as A}from"./LoadingPreview-38bddb96.js";import{d as N,i as $,w as B,c as p,u as e,F as L,a as m,b as g,e as c,s as D,o as r,I,j as y,A as f,_ as O,h as P,k as w,g as l,p as h}from"./index-2d62b16b.js";import{C as R}from"./ClickableContainer-a587937b.js";import{r as U}from"./reactiveForm-a721a671.js";import"./modulepreload-polyfill-3cfb730f.js";/* empty css               */const V={class:"inner"},q={key:0},M=N({__name:"NewsItem",setup(S){const o=$(),{data:u,error:v}=_(`/news/${o.params.uuid}`,P),{form:s,formValid:k,formEditing:n,formNewest:d,submitForm:C,generatePostForm:b}=U({isNew:o.params.uuid==="new",fields:{image:{preview:t=>URL.createObjectURL(t)},name:{required:!0,validate:t=>t.length<=100},content:{required:!0,preview:t=>t.ops,submit:(t,a)=>(Object.values(t.attachments).forEach(i=>a.append("attachments",i)),t.ops)}},defaults:u});B(v,t=>{(t==null?void 0:t.code)==404&&w.push({path:"/news"})});const x=async()=>{if(!n.value)return;const t=await D(["jpg","jpeg","png"]);s.image=t};async function E(){const t=b();if(!t){l.notify("Form is not valid");return}l.isProcessing=!0;try{const a=await h(`/news/${o.params.uuid}`,{data:t});if(a.status!=200){l.notify("Error on server side, try later!!!");return}u.value=await a.json(),o.params.uuid=="new"&&w.replace(`/news/${u.value.uuid}`),C(u.value)}finally{l.isProcessing=!1}}const F=()=>l.showDialog({title:"Delete",text:"Are you sure you want to delete?",handle:async function(){return(await h(`/news/${o.params.uuid}`,{method:"DELETE",data:{uuid:o.params.uuid}})).status!=200?(l.notify("Error on server side, try later!!!"),!1):(w.push({path:"/news"}),!0)}});return(t,a)=>(r(),p("div",V,[e(v)?(r(),p("h1",q,"Fail to receive data!")):e(s)!=null?(r(),p(L,{key:1},[m(e(R),{image:e(s).image,onClick:x},null,8,["image"]),m(e(j),{title:e(n)?null:e(s).name},{actions:g(()=>[e(n)?(r(),c(e(I),{key:0,placeholder:"Name",value:e(s).name,"onUpdate:value":a[0]||(a[0]=i=>e(s).name=i)},null,8,["value"])):y("",!0),m(e(f),{onClick:a[1]||(a[1]=()=>e(n)?E():n.value=!0),text:e(d)?"Add":e(n)?"Save":"Edit",disabled:e(n)&&!e(k)},null,8,["text","disabled"]),e(n)&&!e(d)?(r(),c(e(f),{key:1,text:"Cancel",color:"cancel",onClick:a[2]||(a[2]=i=>n.value=!1)})):e(d)?y("",!0):(r(),c(e(f),{key:2,text:"Delete",color:"cancel",onClick:F}))]),default:g(()=>[m(e(O),{content:e(s).content,"onUpdate:content":a[3]||(a[3]=i=>e(s).content=i),placeholder:e(n)?"Write something...":"Content is empty",readOnly:!e(n)},null,8,["content","placeholder","readOnly"])]),_:1},8,["title"])],64)):(r(),c(e(A),{key:2}))]))}});export{M as default};
