import{D as E,r as O,w as _,E as F,G as W,H as N}from"./index-2d62b16b.js";function q(l){const s={defaults:(E(l.defaults)?l.defaults.value:l.defaults)??{},output:{}},d=O(l.isEdit??l.isNew??!1),h=O(l.isNew??!1),n=O(!1),w=new Proxy(s,{has(u,e){return e.startsWith("__")?u.hasOwnProperty(e):e.startsWith("$")?u.hasOwnProperty(e.slice(1)):l.fields.hasOwnProperty(e)},get(u,e){var r,i,c,o;if(typeof e!="string")return null;if(e.startsWith("__"))return u[e];const t=(r=l==null?void 0:l.fields)==null?void 0:r[e];if(u.output.hasOwnProperty(e)){const f=u.output[e];return f?((i=t==null?void 0:t.preview)==null?void 0:i.call(t,f))??f:null}if(u.defaults.hasOwnProperty(e))return(c=u.defaults)==null?void 0:c[e];if(t!=null&&t.default){const f=typeof(t==null?void 0:t.default)=="function"?(o=t==null?void 0:t.default)==null?void 0:o.call():t==null?void 0:t.default;return u.defaults[e]=f,f}return u.defaults[e]=null,null},set(u,e,t){var i,c,o;if(typeof e!="string")return null;if(e.startsWith("__"))return u[e]=t;if(l!=null&&l.fields&&!((i=l==null?void 0:l.fields)!=null&&i.hasOwnProperty(e)))return!1;if(!d.value)return!1;typeof t=="string"&&(t=t.trim());const r=(c=l==null?void 0:l.fields)==null?void 0:c[e];return r!=null&&r.prepare&&(t=(o=r==null?void 0:r.prepare)==null?void 0:o.call(r,t)),u.output[e]=t,l.fields&&(n.value=!Object.entries(l.fields).some(([f,y])=>{var P;const v=(P=u.output)==null?void 0:P[f],g=y.required??!1;return v?y.validate?!y.validate(v):!1:g&&!h.value&&u.defaults.hasOwnProperty(f)?!1:g})),!0}});return E(l.defaults)&&_(l.defaults,u=>{u&&(s.defaults=Object.assign(s.defaults,u),Object.keys(u).forEach(e=>N(w,"set",e)))}),_(d,u=>{if(!u){const e=Object.keys(s.output);s.output={},e.forEach(t=>N(w,"set",t))}}),{form:F(w),formValid:W(()=>n.value),formEditing:d,formNewest:h,submitForm:function(u){if(!l.fields||!d.value||!n.value)return null;s.defaults=u??Object.assign(s.defaults,s.output),s.output={},d.value=!1,h.value=!1},generatePostForm:function(){if(!l.fields||!d.value||!n.value)return null;const u=new FormData;return Object.entries(l.fields).forEach(([e,t])=>{var i;let r=(i=s.output)==null?void 0:i[e];r!=null&&(r=t!=null&&t.submit?t.submit(r,u):r,r!=null&&(r.constructor==Object||r.constructor==Array)&&(r=JSON.stringify(r)),r&&u.set(e,r))}),u}}}export{q as r};
