import{u as j,A}from"./use-swrv-1943a49d.js";import{L as $}from"./LoadingPreview-38bddb96.js";import{d as B,i as L,w as N,k as m,c as g,u as e,F as D,a as p,b as h,e as f,s as I,o as n,I as O,j as w,A as y,_ as P,h as R,g as u,p as k}from"./index-2d62b16b.js";import{C as U}from"./ClickableContainer-a587937b.js";import{r as V}from"./reactiveForm-a721a671.js";import"./modulepreload-polyfill-3cfb730f.js";/* empty css               */const q={class:"inner"},S={key:0},Q=B({__name:"FoodItem",setup(W){const s=L(),{data:d,error:v}=j(`/food/${s.params.uuid}`,R),{form:r,formValid:C,formEditing:o,formNewest:l,submitForm:F,generatePostForm:b}=V({isNew:s.params.uuid==="new",fields:{image:{preview:t=>URL.createObjectURL(t)},name:{required:!0,validate:t=>t.length<=100},content:{required:!0,preview:t=>t.ops,submit:(t,a)=>(Object.values(t.attachments).forEach(i=>a.append("attachments",i)),t.ops)}},defaults:d});N(v,t=>{(t==null?void 0:t.code)==404&&m.push({path:"/food"})});const c=s.query.category;l.value&&(!c||c.length<20)&&m.push("/foods");const x=async()=>{if(!o.value)return;const t=await I(["jpg","jpeg","png"]);r.image=t};async function E(){const t=b();if(!t){u.notify("Form is not valid");return}l.value&&c&&t.set("category",c),u.isProcessing=!0;try{const a=await k(`/food/${s.params.uuid}`,{data:t});if(a.status!=200){u.notify("Error on server side, try later!!!");return}d.value=await a.json(),s.params.uuid=="new"&&m.replace(`/food/${d.value.uuid}`),F(d.value)}finally{u.isProcessing=!1}}const _=()=>u.showDialog({title:"Delete",text:"Are you sure you want to delete?",handle:async function(){return(await k(`/food/${s.params.uuid}`,{method:"DELETE",data:{uuid:s.params.uuid}})).status!=200?(u.notify("Error on server side, try later!!!"),!1):(m.push({path:"/foods"}),!0)}});return(t,a)=>(n(),g("div",q,[e(v)?(n(),g("h1",S,"Fail to receive data!")):e(r)!=null?(n(),g(D,{key:1},[p(e(U),{image:e(r).image,onClick:x},null,8,["image"]),p(e(A),{title:e(o)?null:e(r).name},{actions:h(()=>[e(o)?(n(),f(e(O),{key:0,placeholder:"Name",value:e(r).name,"onUpdate:value":a[0]||(a[0]=i=>e(r).name=i)},null,8,["value"])):w("",!0),p(e(y),{onClick:a[1]||(a[1]=()=>e(o)?E():o.value=!0),text:e(l)?"Add":e(o)?"Save":"Edit",disabled:e(o)&&!e(C)},null,8,["text","disabled"]),e(o)&&!e(l)?(n(),f(e(y),{key:1,text:"Cancel",color:"cancel",onClick:a[2]||(a[2]=i=>o.value=!1)})):e(l)?w("",!0):(n(),f(e(y),{key:2,text:"Delete",color:"cancel",onClick:_}))]),default:h(()=>[p(e(P),{content:e(r).content,"onUpdate:content":a[3]||(a[3]=i=>e(r).content=i),placeholder:e(o)?"Write something...":"Content is empty",readOnly:!e(o)},null,8,["content","placeholder","readOnly"])]),_:1},8,["title"])],64)):(n(),f(e($),{key:2}))]))}});export{Q as default};
