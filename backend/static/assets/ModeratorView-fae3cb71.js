import{u as j,A as I}from"./use-swrv-1943a49d.js";import{L as N}from"./LoadingPreview-38bddb96.js";import{P}from"./PaginatorControl-9549c4eb.js";import{T as D,a as R}from"./TableViewLine-5f447312.js";import{S as U}from"./SearchControl-e14092d3.js";import{d as _,e as v,b as f,u as e,o as i,a as l,A as m,c as C,F as $,j as q,I as z,M as K,p as S,g as b,r as h,w as V,f as O,h as W}from"./index-2d62b16b.js";import{p as F}from"./formatDate-1a01982f.js";import{r as Q}from"./reactiveForm-a721a671.js";import{I as G}from"./InfoView-5a51acd2.js";import"./modulepreload-polyfill-3cfb730f.js";/* empty css               */async function H(p){if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(p);else{const t=document.createElement("textarea");t.value=p,t.style.position="absolute",t.style.left="-999999px",document.body.prepend(t),t.select();try{document.execCommand("copy")}catch(s){console.error(s)}finally{t.remove()}}}const J=_({__name:"ModeratorModal",props:{item:{type:Object,required:!0}},emits:["close","reload"],setup(p,{emit:t}){var A;const s=t,a=p,{form:c,formValid:y,formEditing:u,formNewest:o,submitForm:g,generatePostForm:x}=Q({isNew:((A=a.item)==null?void 0:A.uuid)=="new",fields:{key_name:{required:!0,validate:d=>d.length<=50}},defaults:a.item});async function r(){const d=x(),n=await S(`/moderator/${a.item.uuid}`,{data:d});if(n.status!=200){b.notify("Error on server side, try later!!!");return}s("reload");const k=await n.json();Object.assign(a.item,k),g(k)}async function E(){if((await S(`/moderator/${a.item.uuid}`,{method:"DELETE",data:{uuid:a.item.uuid}})).status!=200){b.notify("Error on server side validation! Check and try later.");return}s("close"),s("reload"),b.notify("Success remove!")}const L=()=>location.origin+"/admin/@/"+a.item.auth_token;async function M(){await H(L()),b.notify("Link was copied to clipboard!")}async function B(){navigator.share({title:"Clap Academy Authorization",url:L()}).then(()=>console.log("Successful share!")).catch(d=>console.error(d))}return(d,n)=>{var k;return i(),v(e(K),{title:(k=e(c))==null?void 0:k.key_name,onClose:n[3]||(n[3]=w=>d.$emit("close")),visible:""},{actions:f(()=>[l(e(m),{text:"Cancel",onClick:n[1]||(n[1]=w=>e(u)&&!e(o)?u.value=!1:d.$emit("close"))}),e(o)||e(u)?(i(),v(e(m),{key:0,text:"Save",color:"confirm",onClick:r,disabled:!e(y)},null,8,["disabled"])):e(u)?q("",!0):(i(),C($,{key:1},[l(e(m),{text:"Delete",color:"cancel",onClick:E}),l(e(m),{text:"Edit",color:"gold",onClick:n[2]||(n[2]=w=>u.value=!0)})],64))]),default:f(()=>{var w;return[e(u)?(i(),v(e(z),{key:0,placeholder:"Key identifier",value:e(c).key_name,"onUpdate:value":n[0]||(n[0]=T=>e(c).key_name=T),size:"fw"},null,8,["value"])):(i(),C($,{key:1},[l(e(G),{items:{"Created at":e(F)((w=p.item)==null?void 0:w.created_at)}},null,8,["items"]),l(e(m),{text:"Copy auth link",color:"confirm",onClick:M}),l(e(m),{text:"Share auth link",color:"blue",onClick:B})],64))]}),_:1},8,["title"])}}}),X={class:"inner"},ue=_({__name:"ModeratorView",setup(p){const t=h(null),s=h(1),a=h(),{data:c,mutate:y}=j("/moderators",u=>{const o={p:s.value};return a.value&&(o.q=a.value),W(u,o)});return V(s,()=>y()),V(a,()=>y()),(u,o)=>{var g,x;return i(),C("div",X,[e(c)!=null?(i(),C($,{key:0},[l(e(I),{title:"Managers"},{center:f(()=>[l(U,{query:a.value,"onUpdate:query":o[0]||(o[0]=r=>a.value=r)},null,8,["query"])]),actions:f(()=>[l(e(m),{text:"Add manager",onClick:o[1]||(o[1]=r=>t.value={uuid:"new"})})]),default:f(()=>[l(e(D),{header:["Key identifier","Created at"]},{default:f(()=>[(i(!0),C($,null,O(e(c).view,r=>(i(),v(e(R),{key:r.uuid,rows:[r.key_name,e(F)(r.created_at)],onClick:E=>t.value=r},null,8,["rows","onClick"]))),128))]),_:1})]),_:1}),l(e(P),{current:s.value,"onUpdate:current":o[2]||(o[2]=r=>s.value=r),max:((x=(g=e(c))==null?void 0:g.paginator)==null?void 0:x.max)??1},null,8,["current","max"]),t.value?(i(),v(J,{key:0,item:t.value,onReload:e(y),onClose:o[3]||(o[3]=r=>t.value=null)},null,8,["item","onReload"])):q("",!0)],64)):(i(),v(e(N),{key:1}))])}}});export{ue as default};
