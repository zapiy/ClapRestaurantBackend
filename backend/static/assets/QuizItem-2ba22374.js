import{u as T,A as V}from"./use-swrv-1943a49d.js";import{L as P}from"./LoadingPreview-38bddb96.js";import{d as R,e as y,b as x,u as e,o as n,a as d,A as z,j as h,c as l,I as U,F as g,n as C,f as N,t as B,M as G,g as _,p as D,s as I,r as Q,w as S,h as M,i as H,m as J,_ as K,k as L}from"./index-2d62b16b.js";import{C as j}from"./ClickableContainer-a587937b.js";import{r as W}from"./reactiveForm-a721a671.js";import{p as X}from"./formatDate-1a01982f.js";import{P as Y}from"./PaginatorControl-9549c4eb.js";import{T as Z,a as ee}from"./TableViewLine-5f447312.js";import"./modulepreload-polyfill-3cfb730f.js";/* empty css               */const te=C("h2",null,"Correct answer",-1),ne={"d-flex":"h wp"},re=C("h2",null,"Description",-1),ie=C("h2",null,"Options",-1),ae={"d-flex":"h wp"},se=C("h2",null,"Correct Answer",-1),oe=R({__name:"QuizQuestionModal",props:{question:{type:Object,required:!0}},emits:["close","reload"],setup(A,{emit:w}){var r,o;const c=w,m=A,u={image:{preview:i=>URL.createObjectURL(i)},name:{required:!0,validate:i=>i.length<=100},description:{validate:i=>i.length<=1e3}};((r=m.question)==null?void 0:r.type)==="option"&&Object.assign(u,{answers:{required:!0,prepare:i=>{if(!i||i.length==0)return t.correct_answer=null,null;const a=Array.from(i.values()).map(b=>b.toTitleCase());return t.correct_answer&&!a.includes(t.correct_answer)&&(t.correct_answer=null),a},validate:i=>i.length<=100},correct_answer:{required:!0}});const{form:t,formValid:s,formEditing:f,formNewest:k,generatePostForm:q}=W({isNew:((o=m.question)==null?void 0:o.uuid)=="new",fields:u,defaults:m.question});async function E(){var b,$;const i=q();if(!i){_.notify("Form is not valid");return}if(k&&(i.set("type",(b=m.question)==null?void 0:b.type),i.set("quiz",($=m.question)==null?void 0:$.quiz)),(await D(`/quiz/question/${m.question.uuid}`,{data:i})).status!=200){_.notify("Error on server side, try later!!!");return}c("reload"),c("close")}async function F(){if(!f.value)return;const i=await I(["jpg","jpeg","png"]);t.image=i}async function p(){if((await D(`/quiz/question/${m.question.uuid}`,{method:"DELETE",data:{uuid:m.question.uuid}})).status!=200){_.notify("Error on server side validation! Check and try later.");return}c("close"),c("reload"),_.notify("Success remove!")}return(i,a)=>{var b;return n(),y(e(G),{title:(b=e(t))==null?void 0:b.name,onClose:a[5]||(a[5]=$=>i.$emit("close")),visible:""},{actions:x(()=>[d(e(z),{text:"Cancel",onClick:a[4]||(a[4]=$=>e(f)&&!e(k)?f.value=!1:i.$emit("close"))}),e(k)||e(f)?(n(),y(e(z),{key:0,text:"Save",color:"confirm",onClick:E,disabled:!e(s)},null,8,["disabled"])):e(f)?h("",!0):(n(),y(e(z),{key:1,text:"Delete",color:"cancel",onClick:p}))]),default:x(()=>{var $,O;return[d(e(j),{image:e(t).image,title:e(t).image?null:"Image",onClick:a[0]||(a[0]=()=>e(f)?F():null)},null,8,["image","title"]),e(f)?(n(),l(g,{key:0},[d(e(U),{placeholder:"Name",value:e(t).name,"onUpdate:value":a[1]||(a[1]=v=>e(t).name=v),size:"fw"},null,8,["value"]),d(e(U),{placeholder:"Description",type:"multiline",value:e(t).description,"onUpdate:value":a[2]||(a[2]=v=>e(t).description=v),size:"fw"},null,8,["value"]),e(t).type=="option"?(n(),l(g,{key:0},[d(e(U),{placeholder:"Answers",type:"tags",value:e(t).answers,"onUpdate:value":a[3]||(a[3]=v=>e(t).answers=v),size:"fw"},null,8,["value"]),e(t).answers?(n(),l(g,{key:0},[te,C("div",ne,[(n(!0),l(g,null,N(e(t).answers,v=>(n(),y(e(j),{key:v,title:v,checked:e(t).correct_answer==v,onClick:ve=>e(t).correct_answer=v},null,8,["title","checked","onClick"]))),128))])],64)):h("",!0)],64)):h("",!0)],64)):(n(),l(g,{key:1},[e(t).description?(n(),l(g,{key:0},[re,C("span",null,B(e(t).description),1)],64)):h("",!0),e(t).type=="option"&&e(t).answers&&e(t).answers.length>0?(n(),l(g,{key:1},[ie,C("div",ae,[(n(!0),l(g,null,N(e(t).answers,v=>(n(),y(e(j),{key:v.uuid,title:v.name},null,8,["title"]))),128))]),se,d(e(j),{title:(O=($=e(t))==null?void 0:$.correct_answer)==null?void 0:O.name},null,8,["title"])],64)):h("",!0)],64))]}),_:1},8,["title"])}}}),ue={key:0},le=R({__name:"QuizQuestions",props:{uuid:{type:String,required:!0}},setup(A){const w=A,c=Q(1),{data:m,error:u,mutate:t}=T(`/quiz/${w.uuid}/questions`,k=>M(k,{p:c.value}));S(c,()=>t());const s=Q(),f=k=>s.value={uuid:"new",quiz:w.uuid,type:k};return(k,q)=>{var E,F;return e(u)?(n(),l("h1",ue,"Fail to receive question list!")):e(m)?(n(),l(g,{key:1},[d(e(V),{title:"Questions"},{actions:x(()=>[d(e(z),{text:"Add Question",subactions:{text:"Text variant",option:"Option variant"},onClick:q[0]||(q[0]=p=>f(p.type))})]),default:x(()=>[d(e(Z),{header:["Name","Type","Created at"]},{default:x(()=>[(n(!0),l(g,null,N(e(m).view,p=>(n(),y(ee,{onClick:r=>s.value=p,key:p.uuid,rows:[p.name,p==null?void 0:p.type,e(X)({date:p.created_at})]},null,8,["onClick","rows"]))),128))]),_:1})]),_:1}),d(e(Y),{current:c.value,"onUpdate:current":q[1]||(q[1]=p=>c.value=p),max:((F=(E=e(m))==null?void 0:E.paginator)==null?void 0:F.max)??1},null,8,["current","max"]),s.value?(n(),y(oe,{key:0,question:s.value,onReload:e(t),onClose:q[2]||(q[2]=p=>s.value=null)},null,8,["question","onReload"])):h("",!0)],64)):(n(),y(e(P),{key:2}))}}}),de={class:"inner"},ce={key:0},pe={key:0,"d-flex":"h"},me={key:0,"d-flex":"h"},fe=C("span",null,"Required for newbies",-1),xe=R({__name:"QuizItem",setup(A){const w=H(),{data:c,error:m}=T(`/quiz/${w.params.uuid}`,M),{form:u,formValid:t,formEditing:s,formNewest:f,submitForm:k,generatePostForm:q}=W({isNew:w.params.uuid==="new",fields:{image:{preview:r=>URL.createObjectURL(r)},name:{required:!0,validate:r=>r.length<=100},newbie_required:{required:!1,default:!1,submit:r=>r?"true":"false"},passing_percentage:{required:!0,validate:r=>0<=r&&r<=100},content:{required:!1,preview:r=>r.ops,submit:(r,o)=>(Object.values(r.attachments).forEach(i=>o.append("attachments",i)),r.ops)}},defaults:c});S(m,r=>{(r==null?void 0:r.code)==404&&L.push({path:"/quizzes"})});const E=async()=>{if(!s.value)return;const r=await I(["jpg","jpeg","png"]);u.image=r};async function F(){const r=q();if(!r){_.notify("Form is not valid");return}_.isProcessing=!0;try{const o=await D(`/quiz/${w.params.uuid}`,{data:r});if(o.status!=200){_.notify("Error on server side, try later!!!");return}c.value=await o.json(),w.params.uuid=="new"&&L.push(`/quiz/${c.value.uuid}`),k(c.value)}finally{_.isProcessing=!1}}const p=()=>_.showDialog({title:"Delete",text:"Are you sure you want to delete?",handle:async function(){return(await D(`/quiz/${w.params.uuid}`,{method:"DELETE",data:{uuid:w.params.uuid}})).status!=200?(_.notify("Error on server side, try later!!!"),!1):(L.push({path:"/quizzes"}),!0)}});return(r,o)=>{const i=J("mdicon");return n(),l("div",de,[e(m)?(n(),l("h1",ce,"Fail to receive data!")):e(u)!=null?(n(),l(g,{key:1},[d(e(j),{image:e(u).image,onClick:E},null,8,["image"]),e(s)?(n(),l("div",pe,[d(e(U),{placeholder:"Required for newbies",value:e(u).newbie_required,"onUpdate:value":o[0]||(o[0]=a=>e(u).newbie_required=a),type:"checkbox"},null,8,["value"]),d(e(U),{placeholder:"Quiz passing percentage",type:"number",value:e(u).passing_percentage,"onUpdate:value":o[1]||(o[1]=a=>e(u).passing_percentage=a)},null,8,["value"])])):(n(),l(g,{key:1},[e(u).newbie_required?(n(),l("div",me,[d(i,{name:"check"}),fe])):h("",!0),C("span",null,"Quiz passing percentage: "+B(e(u).passing_percentage)+"%",1)],64)),d(e(V),{title:e(s)?null:e(u).name},{actions:x(()=>[e(s)?(n(),y(e(U),{key:0,placeholder:"Name",value:e(u).name,"onUpdate:value":o[2]||(o[2]=a=>e(u).name=a)},null,8,["value"])):h("",!0),d(e(z),{onClick:o[3]||(o[3]=()=>e(s)?F():s.value=!0),text:e(f)?"Add":e(s)?"Save":"Edit",disabled:e(s)&&!e(t)},null,8,["text","disabled"]),e(s)&&!e(f)?(n(),y(e(z),{key:1,text:"Cancel",color:"cancel",onClick:o[4]||(o[4]=a=>s.value=!1)})):e(f)?h("",!0):(n(),y(e(z),{key:2,text:"Delete",color:"cancel",onClick:p}))]),default:x(()=>[d(e(K),{content:e(u).content,"onUpdate:content":o[5]||(o[5]=a=>e(u).content=a),placeholder:e(s)?"Write something...":"Content is empty",readOnly:!e(s)},null,8,["content","placeholder","readOnly"])]),_:1},8,["title"]),!e(s)&&e(c)?(n(),y(le,{key:2,uuid:e(c).uuid},null,8,["uuid"])):h("",!0)],64)):(n(),y(e(P),{key:2}))])}}});export{xe as default};
